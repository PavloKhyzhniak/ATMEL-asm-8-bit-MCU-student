;************************************
;** Файл работы с аналоговым компоратором
;**
;**
;************************************

;************************************
//обработка прерывания от аналогового компоратора
//запускаем таймер 0 для регулирования угла открывания тиристора
ANA_COMP_TRIAC:
; disable Ava_Comp
		in r16, ACSR
		ori r16,(1<<ACD)
		out ACSR, r16


	//выставим определенную задержку на Таймер 0
	LDI ZH,High(2*TableTRIAC)
	LDI ZL,Low(2*TableTRIAC)
	lds r17, Power

lsr r17
lsr r17
lsr r17
lsr r17

	add ZL,r17
	clr r17
	adc ZH,r17
	lpm r16,Z

	;ldi r16,255-4999/64
	out TCNT0,r16
	in r16,TIMSK
	sbr r16,1<<TOIE0	//разрешаем прерывание от Т0
	out TIMSK, r16
	ldi r16,(1<<CS00)+(1<<CS01)	//предделитель на 64
	out TCCR0, r16

	reti
;************************************
