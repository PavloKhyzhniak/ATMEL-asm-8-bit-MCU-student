<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1251"><meta content="Якорев Сергей" name="author">
<meta content="7 days" name="revisit">
<meta content="7 days" name="revisit-after">
<meta name="discription" content=" Изготовление нестандартного оборудования под заказ. Сроки разработки устройств сравнимы со сроками поставки фирменного оборудования из-за рубежа. Подборка реализованных  проектов устройств на микроконтроллерах PIC фирмы Microchip, программирование и разработка, предложения о сотрудничестве."> 
<meta name="keyworlds" content="умный дом, разработка, rc5, IR remote control, IR, ИК, ик, ик пду, ИК ПДУ, ПДУ, разработать, оборудование, дом, автоматизация, RS232,конструктор, ИК ПДУ, пульт, RC5,ШИМ, преобразователь, дом, компьютер,схема, сопряжение, автоматизация,дистанционное, ,микроконтроллер, ассемблер, микросхема, программирование, программа, схема, устройство,микропроцессор, байт, бит, порт, COM, com,  Микрочип, ПИК, assembler, Microchip, MICROCHIP, PIC, PIC18F, ИК ПДУ, MPLAB, Mplab, mplab, microcontroller, PIC micro, PICmicro,, EEPROM, ROM, RAM, память, PROM microprocessor, break, breakpoint, trass, byte, bit, RC, WDT, watchdog,FLASH, EEPROM, RAM, ROM,serial, software, hardware,HI-TECH, MPLAB-C17, MPLAB-C18, HEX, port, PORT, TIMER, timer,PIC16CXXX, PIC16CXX, 16CXXX, 16CXX, 16FXX, 16F84, PIC12CXXX, 12CXXX,
PIC17CXX, PIC17CXXX, 17CXX, 17CXXX, PIC18FXXX, 18FXXX, KeeLoq, программа, система, download,схема, управление, программист ">

	<title>ИК система управления отображением информации формата RC5</title>
</head>
<body lang="RU"> 
 <table border="0" width="100%"><!-- первай столбец !-->
 <tbody><tr><td valign="top" width="30%"> 
 <table bgcolor="#ccffcc" border="0" width="100%">
 <tbody><tr><td bgcolor="#66cc66" height="20"><a href="http://www.yakorev.com.ru/about.html"></a><p align="center"><a href="http://www.yakorev.com.ru/about.html"><font color="#000000">О разработчиках</font></a></p></td></tr>
 <tr><td height="5"></td></tr>
     
              <tr><td bgcolor="#66cc66" height="20"><p align="center"><font color="#000000">Мои разработки</font></p></td></tr>
              <tr><td><font color="#000000"><strong>Оборудование для умного дома</strong> </font></td></tr>
			  <tr><td height="25"><a href="http://www.yakorev.com.ru/udom1.html"><font size="2"> "УМНЫЙ ДОМ" Структурная схема системы "HIA" </font></a> </td></tr>
              <tr><td height="2"></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/smart1.html"><font size="2">Место моих разработок в системе "Умный дом" </font></a> </td></tr>
              <tr><td height="2"></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/smart2.html"><font size="2">Демонстрационный комлект </font></a></td></tr>
              <tr><td height="2"></td></tr>
			  <tr><td height="25"><a href="http://www.yakorev.com.ru/asu.html"><font size="2">Пример реализации системы управления на базе модулей SHD</font></a></td></tr>
              <tr><td height="2"></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/smart3.html"><font size="2">Преобразователь ИК интерфейса в интерфейс RS232 </font></a></td></tr>
              <tr><td height="2"></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/smart4.html"><font size="2">Преобразователь ASCII последовательности в ИК импульсы </font></a> </td></tr>
			  <tr><td height="2"></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/dtmf485.html"><font size="2">Модуль управления с телефона SHD-DTMF/485</font></a></td></tr>
              <tr><td height="2"></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/pdu485.html"><font size="2">Модуль обучаемого ПДУ SHD-IRRC/485</font></a> </td></tr>
			  <tr><td height="2"></td></tr>
			  <tr><td height="25"><a href="http://www.yakorev.com.ru/rc5.html"><font size="2">ИК система управления отображением информации</font></a> </td></tr>
			  <tr><td height="2"></td></tr>
              <tr><td><font color="#000000"><strong>Средства автоматизации</strong> </font></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/adc485.html"><font size="2">Модуль аналого-цифрового преобразователя SHD-ADC/485</font></a> </td></tr>
              <tr><td height="2"></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/rele485.html"><font size="2">Универсальный релейный модуль SHD-RL/485</font></a></td></tr>
              <tr><td height="2"></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/atpcnt.html"><font size="2">Модуль универсального счетчика</font></a> </td></tr>
              <tr><td height="2"></td></tr>
			  <tr><td height="25"><a href="http://www.yakorev.com.ru/count.html"><font size="2">Электронный счетчик количества пройденных рядов вязальной машины</font></a> </td></tr>
              <tr><td height="2"></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/encod.html"><font size="2">Плата управления поворотом платформы по двум координатам </font></a> </td></tr>
              <tr><td height="2"></td></tr>
			  <tr><td><font color="#000000"><strong>Шоу - техника</strong></font></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/dimmer.html"><font size="2">Восьмиканальный диммер, управляемый по протоколу DMX-512</font></a> </td></tr>
              <tr><td height="2"></td></tr>
			  <tr><td height="25"><a href="http://www.yakorev.com.ru/arki.html"><font size="2">Светодиодные арки в кафе "ЭРМИТАЖ" </font></a> </td></tr>
              <tr><td height="2"></td></tr>
              <tr><td><font color="#000000"><strong>Связь</strong> </font></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/ats.html"><font size="2">Мини-АТС с функциями управления по телефону</font></a></td></tr>
              <tr><td height="2"></td></tr>
              <tr><td><font color="#000000"><strong>Видеотехника</strong></font></td></tr>
              <tr><td height="25"><a href="http://www.yakorev.com.ru/videomod.html"><font size="2">Цифровой модулятор видеосигнала</font></a> </td></tr>
              <tr><td height="2"></td></tr>
			  <tr><td height="25"><a href="http://www.yakorev.com.ru/modulat.html"><font size="2">Модулятор на микросхеме TDA8822 с управлением на PIC16F84</font></a> </td></tr>
              <tr><td height="2"></td></tr>
			  <tr><td height="25"><a href="http://www.yakorev.com.ru/videodem.html"><font size="2">Цифровой демодулятор ВЧ сигнала</font></a> </td></tr>
              <tr><td height="2"></td></tr>
			  <tr><td height="25"><a href="http://www.yakorev.com.ru/videoamp.html"><font size="2">Видеоусилитель</font></a> </td></tr>
              <tr><td height="2"></td></tr>
 
 <tr><td bgcolor="#66cc66" height="20"><a href="http://www.yakorev.com.ru/voprosy.html"><p align="center"><font color="#000000">"Умный дом"</font></p></a></td></tr>
 <tr><td height="2"></td></tr>
 <tr><td bgcolor="#66cc66" height="20"><a href="http://www.yakorev.com.ru/konfa.html"><p align="center"><font color="#000000">"Конференц-системы"</font></p></a></td></tr>
 <tr><td height="2"></td></tr>
 <tr><td bgcolor="#66cc66" height="20"><a href="http://www.yakorev.com.ru/reklama.html"><p align="center"><font color="#000000">Оборудование для реклама</font></p></a></td></tr>
 <tr><td height="2"></td></tr>
 <tr><td bgcolor="#66cc66" height="20"><p align="center"><a href="http://www.yakorev.com.ru/linki.html"><font color="#000000">Полезные ссылки</font></a></p></td></tr>			  
 <tr><td height="7"></td></tr> 
 <tr><td bgcolor="#66cc66" height="20"><p align="center"><a href="http://www.yakorev.com.ru/foto.html"><font color="#000000">Фото </font></a></p></td></tr>			  
 <tr><td height="7"></td></tr>
 <tr><td bgcolor="#66cc66" height="20"><p align="center"><a href="http://www.yakorev.com.ru/sotrudn.html"><font color="#000000">Предложения о сотрудничестве</font></a></p></td></tr>
 <tr><td height="7"></td></tr>
 <tr><td bgcolor="#66cc66" height="20"><p align="center"><a href="http://www.yakorev.com.ru/kontakt.html"><font color="#000000">Контакты</font></a></p></td></tr>
 <tr><td height="7"></td></tr>
 <tr><td bgcolor="#66cc66" height="20"><p align="center"><a href="http://www.yakorev.com.ru/novosti.html"><font color="#000000">Новости и мои последние разработки</font></a></p></td></tr>
 <tr><td height="7"></td></tr>
 <tr><td bgcolor="#66cc66" height="20"><p align="center"><a href="http://www.yakorev.com.ru/stavr.html"><font color="#000000">Мой город Ставрополь</font></a></p></td></tr>
 <tr><td height="7"></td></tr>
 <tr><td bgcolor="#66cc66" height="20"><p align="center"><a href="http://www.yakorev.com.ru/faq.html"><font color="#000000">FAQ</font></a></p></td></tr>
 <tr><td height="7"></td></tr>
 <tr><td bgcolor="#66cc66" height="20"><p align="center"><a href="http://www.yakorev.com.ru/index.html"><font color="#000000">На главную</font></a></p></td></tr>  
 </tbody></table>
 <font color="green" size="2">©<small> Якорев Сергей<p></p></small></font>
  <!-- HotLog -->
<p>
<script type="text/javascript" language="javascript">
hotlog_js="1.0";
hotlog_r=""+Math.random()+"&s=439990&im=214&r="+escape(document.referrer)+"&pg="+
escape(window.location.href);
document.cookie="hotlog=1; path=/"; hotlog_r+="&c="+(document.cookie?"Y":"N");
</script>
<script type="text/javascript" language="javascript1.1">
hotlog_js="1.1";hotlog_r+="&j="+(navigator.javaEnabled()?"Y":"N")
</script>
<script type="text/javascript" language="javascript1.2">
hotlog_js="1.2";
hotlog_r+="&wh="+screen.width+'x'+screen.height+"&px="+
(((navigator.appName.substring(0,3)=="Mic"))?
screen.colorDepth:screen.pixelDepth)</script>
<script type="text/javascript" language="javascript1.3">hotlog_js="1.3"</script>
<script type="text/javascript" language="javascript">hotlog_r+="&js="+hotlog_js;
document.write("<a href='http://click.hotlog.ru/?439990' target='_top'><img "+
" src='http://hit23.hotlog.ru/cgi-bin/hotlog/count?"+
hotlog_r+"&' border=0 width=88 height=100 alt=HotLog><\/a>")
</script><a href="http://click.hotlog.ru/?439990" target="_top"><img src="rc5_files/count.gif" alt="HotLog" border="0" height="100" width="88"></a>
<noscript>
<a href="http://click.hotlog.ru/?439990" target="_top">
<img src="http://hit23.hotlog.ru/cgi-bin/hotlog/count?s=439990&amp;im=214" border="0" 
 width="88" height="100" alt="HotLog"></a>
</noscript>

 </p></td><!-- конец данных первого столбца-->
 <!-- второй столбец пустой!--> <td width="3%"></td>
 <!-- третий столбец для основного текста!--> <td valign="top" width="67%">   
	


<a href="http://www.yakorev.com.ru/" target="_blank"><img alt="" src="rc5_files/baner.gif" border="0" width="250"></a> 

<p><b>ИК система управления отображением информации</b>
</p><p><b>Введение.</b>
</p><p>Прежде чем была реализована ИК система управления отображением информации, мне пришлось 
пересмотреть массу справочной информацию. В Internet  сейчас очень много подобной информации.
Я постарался в одной статье объединить накопленные знания. 
Я благодарен всем, кто сделал доступной информацию по вопросу декодирования ИК команд фомата RC5. 
А также всем тем, кто занимается сопряжением разрабатываемых устройств с РС. 
Так как в сети порой трудно найти автора той или иной информации 
(информация просто дублируется на нескольких сайтах, немного видоизменяясь), я прошу авторов написать 
мне письмо и я укажу ваше авторство. Со своей строны я выкладываю все исходники. Используйте в своих 
разработках. Если публикуете на своем сайте , оставляйте банер со ссылкой на мой сайт или иным 
образом указывайте авторство.</p>
<p>В сети Internet много простых устройств на базе контроллеров семейства PIC16F и  PIC18F фирмы Microchip. 
Я предлагаю вашему вниманию 
достаточно сложное устройство. Эта статья думаю будет полезна всем, кто пишет программы для PIC18F,
так как вы можете взяв исходные тексты программы создать свою систему реального времени.  
Информации будет предостаточно, начиная от теории и стандартов, заканчивая аппаратной и программной 
реализацией данного проекта. Исходные тексты на асемблере снабжены полными коментариями. 
Поэтому не сложно будет разобраться в программе.</p>
<p><b>Идея.</b>
</p><p> Как всегда все начинается с идеи. Имеем карту Ставропольского края. На карте имеется 26 районов
края. Размер карты 2х3м. Необходимо управлять подсветкой выбранных районов. Управление должно осуществляться
дистанционно по инфракрасному каналу управления, далее по тексту просто ИК или IR remote control.
Одновременно команды управления должны передаваться на сервер управления на базе РС. 
При выборе района на карте, сервер управления отображает дополнительную инфомацию на мониторе.
По командам с сервера можно управлять отображением информации на карте. Задача поставлена.
В конечном итоге мы получили, то что вы видите на фото. Но прежде чем все это реализовать 
пришлось пройти некоторые этапы и решить различные технические задачи.
</p><p><img src="rc5_files/mapf.jpg" nosave="" width="400"> 
<br><b>ИК система управления отображением информации.</b>
</p><p><img src="rc5_files/mapm.jpg" nosave="" width="400"> 
<br><b>Вид со стороны монтажа.</b>
</p>
<p><b>Алгоритм работы устройства.</b>
<br>С пульта дистанционного управления система  управления отображением информации 
должна управляться не сложнее выбора программы на TV или задания номера трека на CD. 
Было решено пульт взять готовый от видеомагнитофона PHILIPS. 
Выбор номера район задается последовательным нажатим кнопок пульта "Р+"   
далее две цифровые кнопки номера района, заканчиваем ввод "Р-".
При первом выборе района осуществляется его выделение, (включается подсветка светодиодами) 
а при повторном выборе снимается выделение.
<br>Протокол управления картой с РС сервера управления. 
<br>1.	Исходящие команды, т.е. команды поступающие с устройства в РС:
<br>1.1.	При включении питания на устройстве в РС поступает команда:<b>MAP999[0D]</b>
<br>1.2.	При включении района: <b>MAP(номер района)1[0D]</b>
<br>1.3.	При выключении района: <b>MAP(номер района)0[0D]</b>
<br>1.4.	При включении всей карты: <b>MAP001[0D]</b>
<br>1.5.	При выключении всей карты: <b>MAP000[0D]</b>
<br>2.	Входящие команды:
<br>2.1.	Включить всю карту: <b>MAP001[0D]</b>
<br>2.2.	Выключить всю карту: <b>MAP000[0D]</b>
<br>2.3.	Включить район: <b>MAP(номер района)1[0D]</b>
<br>2.4.	Выключить район: <b>MAP(номер района)0[0D]</b>
<br>2.5.	Получить информацию о включенных районах: <b>MAP999[0D]</b> 
В ответ на эту команду передаются данные о всех включенных районах в формате п. 1.2 
(как будто все включенные районы заново включаются).
<br>2.6.	Получить информацию о выключенных районах: <b>MAP995[0D]</b> 
В ответ на эту команду передаются данные о всех выключенных районах в формате п. 1.3 
(как будто все выключенные районы заново выключаются).

<br>При выключении последнего включенного района также должна поступать команда "выключение всей карты". 
<br>При включении последнего невключенного района также должна поступать команда "включение всей карты".
<br>Номер района представляет собой ASCII-символы цифр (0x30-0x39).


</p><p><b>От идеи к реализации.</b>
</p><p>Предвидя, что довольно сложной проблемой может оказаться изготовление собственного корпуса для 
пульта ДУ, было решено  взять готовый пульт ДУ от серийного аппарата. За основу системы ИК управления 
выбрана система команд ИК управления формата RC5. В настоящее время для управления различной 
аппаратурой очень широко используется дистанционное управление (ДУ) на ИК-лучах.
 Пожалуй, первым видом бытовой аппаратуры, где использовалось ИК ДУ, были телевизоры. 
 Сейчас ДУ имеется в большинстве видов бытовой аудио- и видеотехники. 
 Даже переносные музыкальные центры в последнее время все чаще оборудуют системой ДУ. 
 Но бытовая техника это не единственная сфера применения ДУ. Довольно широко распространены приборы 
 с ДУ и на производстве, и в научных лабораториях. В мире существует достаточно много не совместимых
 между собой систем ИК ДУ. Наибольшее распространение получила система RC-5. Эта система используется
 во многих телевизорах, в том числе и отечественных. В настоящее время разными заводами выпускается
 несколько модификаций пультов ДУ RC-5, причем, некоторые модели имеют вполне приличный дизайн.
 Это позволяет с наименьшими затратами получить самодельное устройство с ИК ДУ. 
 Опуская подробности, почему была выбрана именно эта система, расмотрим теорию построения
 система на базе формата RC5.</p>
<p><b>Теория.</b>
</p><p>Что бы понять как работает система управления необходимо вникнуть, что же представляет собой 
сигнал на выходе пульта ИК ДУ.</p>
<p>Система инфракрасного дистанционного управления RC-5 была разработана фирмой Philips 
для нужд управления бытовой аппаратурой. Когда мы нажимаем кнопку пульта, микросхема передатчика 
активизируется и генерирует последовательность импульсов, которые имеют заполнение частотой 36 КГц. 
Светодиоды преобразуют эти сигналы в ИК-излучение. Излученный сигнал принимается фотодиодом, 
который снова преобразует ИК-излучение в электрические импульсы. Эти импульсы усиливаются и 
демодулируются микросхемой приемника. Затем они подаются на декодер. Декодирование обычно 
осуществляется программно с помощью микроконтроллера. Об этом мы подробно поговорим в разделе 
посвященному декодированию.  Код RC5 поддерживает 2048 команд. Эти команды составляют 32 группы 
(системы) по 64 команды в каждой. Каждая система используется для управления определенным устройством, 
таким как телевизор, видеомагнитофон и т.д.</p> 
<p>На заре становления систем ИК управления формирование сигнала происходило аппаратно. 
Для этого разрабатывались специализированные ИС, а сейчас все чаще пульты ДУ делаются на основе 
микроконтроллера.
</p><p>Одной из наиболее распространенных микросхем передатчика является микросхема 
SAA3010. Кратко рассмотрим ее характеристики. 
</p><ul>
  <li><font color="#000099">Напряжение питания – 2 .. 7 В</font> 
  </li><li><font color="#000099">Потребляемый ток в ждущем режиме – не более 10 
  мка</font> 
  </li><li><font color="#000099">Максимальный выходной ток - ±10 мА</font> 
  </li><li><font color="#000099">Максимальная тактовая частота – 450 КГц</font> 
</li></ul>Структурная схема микросхемы SAA3010 показана на рисунке 1. 
<center>
<p><img src="rc5_files/map1.gif" nosave="" height="395" width="433"> 
</p><p><b>Рисунок 1. Структурная схема ИС SAA3010.</b></p></center>
<p>Описание выводов микросхемы SAA3010 приведено в таблице: <br>&nbsp; 
</p><center>
<table border="1" width="100%">
  <tbody>
  <tr>
    <td><font size="-1">&nbsp;Вывод</font></td>
    <td><font size="-1">&nbsp;Обозначение</font></td>
    <td><font size="-1">&nbsp;Функция</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;1</font></td>
    <td><font size="-1">&nbsp;X7</font></td>
    <td><font size="-1">&nbsp;Входные линии матрицы кнопок</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;2</font></td>
    <td><font size="-1">&nbsp;SSM</font></td>
    <td><font size="-1">&nbsp;Вход выбора режима работы</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;3-6</font></td>
    <td><font size="-1">&nbsp;Z0-Z3</font></td>
    <td><font size="-1">&nbsp;Входные линии матрицы кнопок</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;7</font></td>
    <td><font size="-1">&nbsp;MDATA</font></td>
    <td><font size="-1">&nbsp;Модулированные выходные данные,&nbsp; 1/12 частоты 
      резонатора, скважность 25%</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;8</font></td>
    <td><font size="-1">&nbsp;DATA</font></td>
    <td><font size="-1">&nbsp;Выходные данные</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;9-13</font></td>
    <td><font size="-1">&nbsp;DR7-DR3</font></td>
    <td><font size="-1">&nbsp;Выходы сканирования</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;14</font></td>
    <td><font size="-1">&nbsp;VSS</font></td>
    <td><font size="-1">&nbsp;Земля</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;15-17</font></td>
    <td><font size="-1">&nbsp;DR2-DR0</font></td>
    <td><font size="-1">&nbsp;Выходы сканирования</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;18</font></td>
    <td><font size="-1">&nbsp;OSC</font></td>
    <td><font size="-1">&nbsp;Вход генератора</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;19</font></td>
    <td><font size="-1">&nbsp;TP2</font></td>
    <td><font size="-1">&nbsp;Тестовый вход 2</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;20</font></td>
    <td><font size="-1">&nbsp;TP1</font></td>
    <td><font size="-1">&nbsp;Тестовый вход 1</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;21-27</font></td>
    <td><font size="-1">&nbsp;X0-X6</font></td>
    <td><font size="-1">&nbsp;Входные линии матрицы кнопок</font></td></tr>
  <tr>
    <td><font size="-1">&nbsp;28</font></td>
    <td><font size="-1">&nbsp;VDD</font></td>
    <td><font size="-1">&nbsp;Напряжение 
питания</font></td></tr></tbody></table></center>
<p>Микросхема передатчика является основой пульта дистанционного управления. На 
практике один и тот же пульт дистанционного управления может использоваться для 
управления несколькими устройствами. Микросхема передатчика может адресовать 32 
системы в двух различных режимах: комбинированном и в режиме одной системы. В 
комбинированном режиме сначала выбирается система, а затем команда. Номер 
выбранной системы (адресный код) хранится в специальном регистре и происходит 
передача команды, относящейся к этой системе. Таким образом, для передачи любой 
команды требуется последовательное нажатие двух кнопок. Это не совсем удобно и 
оправдано только при работе одновременно с большим количеством систем. На 
практике передатчик чаще используется в режиме одной системы. При этом вместо 
матрицы кнопок выбора системы монтируется перемычка, которая и определяет номер 
системы. В этом режиме для передачи любой команды требуется нажатие только одной 
кнопки. Применив переключатель, можно работать с несколькими системами. И в этом 
случае для передачи команды требуется нажатие только одной кнопки. Передаваемая 
команда будет относится к той системе, которая в данное время выбрана с помощью 
переключателя. 
</p><p>Для включения комбинированного режима на вывод передатчика SSM (Single System 
Mode) нужно подать низкий уровень. В этом режиме микросхема передатчика работает 
следующим образом: во время покоя X и Z-линии передатчика находятся в состоянии 
высокого уровня с помощью внутренних p-канальных подтягивающих транзисторов. 
Когда нажата кнопка в матрице X-DR или Z-DR, запускается цикл подавления 
дребезга клавиатуры. Если кнопка замкнута на протяжении 18 тактов, фиксируется 
сигнал "разрешение генератора". В конце цикла подавления дребезга DR-выходы 
выключаются и запускаются два цикла сканирования, включающие по очереди каждый 
выход DR. В первом цикле сканирования обнаруживается Z-адрес, во втором - 
X-адрес. Когда Z-вход (матрица системы) или X-вход (матрица команды) 
обнаруживается в состоянии нуля, происходит фиксация адреса. При нажатии кнопки 
в матрице системы передается последняя команда (т.е. все биты команды равны 
единице) в выбираемой сиcтеме. Эта команда передается до тех пор, пока кнопка 
выбора системы не будет отпущена. При нажатии кнопки в матрице команды 
передается команда вместе с адресом системы, хранимом в регистре-фиксаторе. Если 
кнопка отпущена до начала передачи,&nbsp; происходит сброс. Если же передача 
началась, то независимо от состояния кнопки, она будет выполнена полностью. Если 
одновременно нажато более одной Z или X кнопки, то генератор не запускается. 
<br>Для включения режима одной системы на выводе SSM должен быть высокий 
уровень, а адрес системы должен быть задан соответствующей перемычкой или 
переключателем. В этом режиме во время покоя X-линии передатчика находятся в 
состоянии высокого уровня. В то же время Z-линии выключены для предотвращения 
потребления тока. В первом из двух циклов сканирования определяется адрес 
системы и сохраняется в регистре-фиксаторе. Во втором цикле определяется номер 
команды. Эта команда передается вместе с адресом системы, хранимом в 
регистре-фиксаторе. Если нет перемычки Z-DR, то никакие коды не передаются. 
</p><p>Если кнопка была отпущена между посылками кода, то происходит сброс. Если 
кнопка была отпущена во время процедуры подавления дребезга или во время 
сканирования матрицы, но до обнаружения нажатия кнопки, то также происходит 
сброс. Выходы DR0 – DR7 имеют открытый сток, в состоянии покоя транзисторы 
открыты. <br>В коде RC-5 имеется дополнительный управляющий бит, который 
инвертируется при каждом отпускании кнопки. Этот бит информирует декодер о том, 
удерживается кнопка или произошло новое нажатие. Бит управления инвертируется 
только после полностью завершенной посылки. Циклы сканирования производятся 
перед каждой посылкой, поэтому даже если во время передачи посылки сменить 
нажатую кнопку на другую, все равно номер системы и команды будут переданы 
правильно. 
</p><p>Вывод OSC представляет собой вход/выход 1-выводного генератора и предназначен 
для подключения керамического резонатора на частоту 432 КГц. Последовательно с 
резонатором рекомендуется включть резистор сопротивлением 6,8 Ком. 
</p><p>Тестовые входы TP1 и TP2 в нормальном режиме работы должны быть соединены с 
землей. При высоком логическом уровне на TP1 повышается частота сканирования, а 
при высоком уровне на TP2 – частота работы сдвигового регистра. 
</p><p>В состоянии покоя выходы DATA и MDATA находятся в Z-состоянии. Генерируемая 
передатчиком на выходе MDATA последовательность импульсов имеет заполнение 
частотой 36 кГц (1/12 частоты тактового генератора) со скважностью 25%. На 
выходе DATA генерируется такая же последовательность, но без заполнения. Этот 
выход используется в том случае, когда микросхема передатчика выполняет функции 
контроллера встроенной клавиатуры. Сигнал на выходе DATA полностью идентичен 
сигналу на выходе микросхемы приемника дистанционного управления (но в отличие 
от приемника он не имеет инверсии). Оба этих сигнала могут обрабатываться одним 
и тем же декодером. Применение SAA3010 в качестве контроллера встроенной 
клавиатуры в некоторых случаях очень удобно, так как для опроса матрицы до 64 
кнопок у микроконтроллера расходуется только один вход прерывания. Тем более, 
что микросхема передатчика допускает питание напряжением +5 В. 
</p><p>Передатчик генерирует 14-битное слово данных, формат которого следующий: 
</p><blockquote>
  <li><font color="#000099">&nbsp;- 2 стартовых бита.</font> 
  </li><li><font color="#000099">&nbsp;- 1 управляющий бит.</font> 
  </li><li><font color="#000099">- 5 бит адреса системы.</font> 
  </li><li><font color="#000099">&nbsp;- 6 бит команды.</font> </li></blockquote>
<center>
<p><br><img src="rc5_files/map2.gif" nosave="" height="266" width="698"> 
</p><p><b>Рисунок 2. Формат слова данных кода RC-5.</b></p></center>
<p>Стартовые биты предназначены для установки АРУ в IC приемника. Управляющий 
бит является признаком нового нажатия. Длительность такта составляет 1.778 мс. 
Пока кнопка остается нажатой, слово данных передается с интервалом 64 такта, 
т.е. 113.778 мс (рис. 2).

 </p><p>Первые два импульса являются стартовыми, и 
 оба - логические "1". Отметим, что половина бита (пустая) 
 проходит раньше, чем приемник определит реальный старт 
 сообщения. 
 <br>Расширенный RC5 протокол использует только 1 
 старт-бит. Бит S2 трансформируется и добавляетсяк 6-му биту 
 команды, образуя в целом 7 битов команды. 
 <br><br>Третий бит - управляющий. Этот бит инвертируется всякий раз, когда 
 нажимается клавиша. Таким путем приемник может различать 
 клавишу, которая остается нажатой, или периодически 
 нажимается. 
 <br>Следующие 5 бит представляют адресс ИК 
 устройства, который посылается с первым LSB. За адресом 
следуют 6 бит команды. 
<br>Сообщение содержит 14 бит, вместе с 
 паузой имеют общую длительность 25.2 мс. Иногда сообщение 
 может оказаться короче из-за того, что первая половина 
 старт-бита S1 остается незаполненной. И если последний бит 
 команды является логическим "0", тогда последняя часть бита 
 сообщения также пустая. 
 <br>Если клавиша остается нажатой, 
 сообщение будет повторяться каждые 114 мс. Управляющий бит 
 будет оставаться одинаковым во всех сообщениях. Это сигнал для 
 программы приемника интерпретировать это как  функцию автоповтора. </p>

 Для обеспечения хорошей помехоустойчивости применяется 
двухфазное кодирование (рис. 3). 
<center>
<p><img src="rc5_files/map3.gif" nosave="" height="160" width="437"> 
</p><p><b>Рисунок 3. Кодирование «0» и «1» в коде RC-5.</b></p></center>
<p>При использовании кода RC-5 может понадобиться вычислить средний потребляемый 
ток. Сделать это достаточно просто, если воспользоваться рис. 4, где показана 
подробная структура посылки. 
</p><center>
<p><img src="rc5_files/map4.gif" nosave="" height="400" width="619"> 
</p><p><b>Рисунок 4. Подробная структура посылки RC-5.</b></p></center>
<p>Для обеспечения одинакового реагирования оборудования на команды RC-5, коды 
распределены вполне определенным образом. Такая стандартизация позволяет 
конструировать передатчики, позволяющие управлять различными устройствами. С 
одними и теми же кодами команд для одинаковых функций в разных устройствах 
передатчик с относительно небольшим числом кнопок может управлять одновременно, 
например, аудиокомплексом, телевизором и видеомагнитофоном. 
</p><p>Номера систем для некоторых видов бытовой аппаратуры приведены ниже: 
</p><blockquote>
<i><font color="#000099">0 - Телевизор (TV)</font></i> 
<br><i><font color="#000099">2 - Телетекст</font></i> 
<br><i><font color="#000099">3 - Видеоданные</font></i> 
<br><i><font color="#000099">4 - Видеопроигрыватель (VLP)</font></i> 
<br><i><font color="#000099">5 - Кассетный видеомагнитофон (VCR)</font></i> 
<br><i><font color="#000099">8 - Видео тюнер (Sat.TV)</font></i> 
<br><i><font color="#000099">9 - Видеокамера</font></i> 
<br><i><font color="#000099">16 - Аудио предусилитель</font></i> 
<br><i><font color="#000099">17 - Тюнер</font></i> 
<br><i><font color="#000099">18 - Магнитофон</font></i> 
<br><i><font color="#000099">20 - Компакт-проигрыватель (CD)</font></i> 
<br><i><font color="#000099">21 - Проигрыватель (LP)</font></i> 
<br><i><font color="#000099">29 - Освещение</font></i>
</blockquote>
<br>Остальные номера систем зарезервированы для будущей стандартизации или для 
экспериментального использования. Стандартизировано также соответствие некоторых 
кодов команд и функций. <br>Коды команд для некоторых функций приведены ниже: 
<blockquote>
<i><font color="#000099">0-9 - Цифровые величины 0-9</font></i> 
<br><i><font color="#000099">12 - Дежурный режим</font></i> 
<br><i><font color="#000099">15 - Дисплей</font></i> 
<br><i><font color="#000099">13 - mute</font></i> 
<br><i><font color="#000099">16 - громкость +</font></i> 
<br><i><font color="#000099">17 - громкость -</font></i> 
<br><i><font color="#000099">30 - поиск вперед</font></i> 
<br><i><font color="#000099">31 - поиск назад</font></i> 
<br><i><font color="#000099">45 - выброс</font></i> 
<br><i><font color="#000099">48 - пауза</font></i> 
<br><i><font color="#000099">50 - перемотка назад</font></i> 
<br><i><font color="#000099">51 - перемотка вперед</font></i> 
<br><i><font color="#000099">53 - воспроизведение</font></i> 
<br><i><font color="#000099">54 – стоп</font></i> 
<br><i><font color="#000099">55 - запись</font></i>
</blockquote>
<br>Для того, чтобы на основе микросхемы передатчика 
построить законченный пульт ИК ДУ, необходим еще драйвер светодиода, который 
способен обеспечивать большой импульсный ток. Современные светодиоды работают в 
пультах ДУ при импульсных токах около 1 А. Драйвер светодиода очень удобно 
строить на низкопороговом (logic level) МОП-транзисторе, например, КП505А. 
Пример принципиальной схемы пульта приведен на рис. 5. 
<center>
<p><img src="rc5_files/map9.gif" nosave="" height="378" width="558"> 
</p><p><b>Рисунок 5. Принципиальная схема пульта RC-5.</b></p></center>
<p>Номер системы задается перемычкой между выводами Zi и DRj. Номер системы при 
этом будет следующим: 
</p><center>
<p>SYS = 8i + j</p></center>
<p>Код команды, который будет передаваться при нажатии кнопки, которая замыкает 
линию Xi с линией DRj, вычисляется следующим образом: 
</p><center>
<p>COM = 8i + j</p></center>
<p>Приемник ИК ДУ должен восстанавливать данные с двухфазным кодированием, он 
должен реагировать на большие быстрые изменения уровня сигнала независимо от 
помех. Ширина импульсов на выходе приемника должна отличаться от номинальной не 
более чем на 10%. Приемник должен быть нечувствительным к постоянным внешним 
засветкам. Удовлетворить всем этим требованиям достаточно непросто. Старые 
реализации приемника ИК ДУ, даже с применением специализированных микросхем, 
содержали десятки компонентов. Такие приемники часто использовали резонансные 
контуры, настроенные на частоту 36 КГц. Все это делало конструкцию сложной в 
изготовлении и настройке, требовало применения хорошего экранирования. В 
последнее время большое распространение получили трехвыводные интегральные 
приемники ИК ДУ. В одном корпусе они объединяют фотодиод, предусилитель и 
формирователь. На выходе формируется обычный ТТЛ сигнал без заполнения 36 КГц, 
пригодный для дальнейшей обработки микроконтроллером. Такие приемники 
производятся многими фирмами, это SFH-506 фирмы Siemens, TFMS5360 фирмы Temic, 
ILM5360 производства ПО «Интеграл» и другие. В настоящее время имеются и более 
миниатюрные варианты таких микросхем. Поскольку кроме RC-5 существуют и другие 
стандарты, которые отличаются, в частности, частотой заполнения, существуют 
интегральные приемники для разных частот. Для работы с кодом RC-5 следует 
выбирать модели, рассчитанные на частоту заполнения 36 КГц. 

</p><p>В качестве приемника ИК ДУ можно применить и фотодиод с 
усилителем-формирователем, в качестве которого может служить специализированная 
микросхема КР1568ХЛ2. Схема такого приемника приведена на рисунке 6. 
</p><center>
<p><img src="rc5_files/map13.gif" nosave="" height="159" width="436"> 
</p><p><b>Рисунок 6. Приемник на микросхеме КР1568ХЛ2.</b></p></center>

<p>Для системы управления отображением информации я выбрал интегральный приемник ИК ДУ. 
В качестве приемника оптического излучения в микросхеме TSOP1736 установлен высокочувствительный 
PIN фотодиод, сигнал с которого поступает на входной усилитель, преобразующий выходной ток фотодиода 
в напряжение. Преобразованный сигнал поступает на усилитель с АРУ и далее на полосовой фильтр, 
который выделяет сигналы с рабочей частотой 36 кГц из шумов и помех. Выделенный сигнал поступает 
на демодулятор, который состоит из детектора и интегратора. В паузах между импульсами производится 
калибровка системы АРУ. Управляет этим схема управления. Благодаря такому построению, микросхема 
не реагирует на непрерывную помеху даже на рабочей частоте. Активный уровень выходного сигнала - 
низкий. Микросхема не требует для своей работы установки каких-либо внешних элементов. 
Все ее компоненты, включая фотоприемник, защищены от внешних наводок внутренним электрическим 
экраном и залиты специальной пластмассой. Эта пластмасса является фильтром, отсекающим оптические 
помехи в видимом диапазоне света. Благодаря всем этим мерам микросхема отличается весьма высокой 
чувствительностью и низкой вероятностью появления ложных сигналов.
И всеже интегральные приемники весьма чувствительны к помехам по питанию, поэтому всегда 
рекомендуется применять фильтры, например, RC. Внешний вид интегрального 
фотоприемника и расположение выводов показаны на рис. 7. 
</p><center>
<p><img src="rc5_files/map8.gif" nosave="" height="275" width="142"> 
</p><p><b>Рисунок 7. Интегральный приемник RC-5.</b></p></center>

<p><b>Декодирование  RC-5.</b>
</p><p>Так как основу нашего устройства составляет микроконтроллера PIC18F252 декодирование кода RC-5 будем 
осуществлять программно. Предлагаемые в сети алгоритмы приема кода RC5 в большинстве своем не подходят для 
устройств реального времени, каким авляется наше устройство. Большинство предложенных алгоритмов 
используют программные циклы для формирования временных задержек и интервалов измерения. Для нашего случая это не подходит. 
Решено использовать прерывания по спаду сигнала на входе INT микроконтроллера PIC18F252, временные параметры измерять 
при помощи TMR0 микроконтроллера PIC18F252, этот же таймер вырабатывает прерывание когда истекло время ожидания 
следующего импульса, т.е. когда наступила пауза между двумя посылками.
Демодулированный сигнал с выхода микросхемы DA1, поступает на вход INT0 микроконтроллера, в котором 
происходит его дешифрация и выдача дешифрированной команды на сдвиговые регистры для управления ключами.
Алгоритм дешифрации основан на измерении временных интервалов между прерываниями микроконтроллера PIC18F252.
Если внимательно посмотреть на рисунок 8, можно заметить некоторые особенности. Так если интервал между прерываниями 
микроконтроллера PIC18F252 был равен 2Т, где Т это длительность единичного импулься RC5, то 
принятый бит может быть 0 или 1. Все зависит от того какой бит был перед этим. 
В приведенной ниже программе с подробными коментариями это очень хорошо видно. 
Полностью весь проект доступен для скачивания и использования в личных целях. 
При перепечатывании ссылка обязательна. 


<br></p><p>Ответы и дополнительная информация по данному проекту будет доступна в 
разделе <a href="http://www.yakorev.com.ru/faq.html">FAQ </a> моего сайта.
<br></p><p>Проект выполнен в среде MPLAB5.0. 
<br>1.Основной ASM файл 
<br>2.Файл определений переменных, констант , регистров 
<br>3.Файл подпрограмм ввода вывода
<br>4.Файл подпрограмм инициализации узлов микроконтроллера
<br>5.Файл обслуживания узла сброса и индикации
<br>6.Файл приема команд управления по ИК
<br>7.Файл приема команд управления по RS232 
<br>8.Файл вычисляемых таблиц переходов


</p><p>
</p><p><img src="rc5_files/map14.jpg" nosave="" width="800"> 
</p><p><b>Рисунок 8. Пояснения к принципу декодирования RC-5.</b>
</p><p>
</p><p>
</p><p><b>ПРОГРАММА ПРИЕМА КОДА ПО ИК КАНАЛУ В ФОРМАТЕ RC5</b>
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman";}
@page Section1
	{size:595.3pt 841.9pt;
	margin:14.2pt 42.55pt 14.2pt 1.0cm;}
div.Section1
	{page:Section1;}
-->
</style>





</p><div class="Section1">

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;**************************************************************</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
ПРОГРАММА ПРИЕМА КОДА ПО ИК КАНАЛУ В ФОРМАТЕ RC5</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;**************************************************************
</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">INT_PROC</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BCF&nbsp;&nbsp;&nbsp; INTCON,INT0IF,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
СБРОСИТЬ ФЛАГ ПРЕРЫВАНИЯ ОТ ВХОДА INT</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BCF&nbsp;&nbsp;&nbsp; INTCON,TMR0IF,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
CБРОС ФЛАГA ПРЕРЫВАНИЙ ТАЙМЕРА TMR0</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 MOVF&nbsp;&nbsp; 
TMR0L,W,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ;
НАСТРОЙКА ТАЙМЕРА TMR0 ТАК ЧТОБЫ ВО ВРЕМЯ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVWF&nbsp; TMR_TEMP,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
ПАУЗЫ МЕЖДУ ПОВТОРАМИ ПОСЫЛКИ ПРОИЗОШЛО ПРЕРЫВАНИЕ </span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 CLRF&nbsp;&nbsp; 
TMR0L,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ;
ПРЕРЫВАНИЕ ОТ TMR0 БУДЕТ ГОВОРИТЬ О ТОМ ЧТО ПОСЫЛКА ПОЛНОСТЬЮ ПРИНЯТА</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 BSF&nbsp;&nbsp;&nbsp; 
RC5_START&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ;
ОБНАРУЖЕН СТАРТОВЫЙ ИМПУЛЬС RC5</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;**************************************************************
</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">TEST_RX_BIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ;
ОПРЕДЕЛЯЕМ ЧТО ПРИШЛО ПО ИК КАНАЛУ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MOVF&nbsp;&nbsp;&nbsp; RC5_BIT_COUNT,F,A&nbsp;&nbsp; ; ЭТО ПЕРВЫЙ СТАРТОВЫЙ БИТ?</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;BTFSC&nbsp;&nbsp; STATUS,Z,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; Т.Е СЧЕТЧИК ПРИНЯТЫХ ДАННЫХ РАВЕН 0</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
GOTO&nbsp;&nbsp;&nbsp; RC5_ADD_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; ТОГДА ОДНОЗНАЧНО ОН РАВЕН 1</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
ПО ВРЕМЕННОМУ ОКНУ ОПРЕДЕЛЯЕМ ЗНАЧЕНИЕ ПРИНЯТЫХ ДАННЫХ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MOVLW&nbsp;&nbsp;
 
1E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ; ВРЕМЕННОЙ ИНТЕРВАЛ РАВЕН 2Т&nbsp; 
===&gt;1C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 </span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
SUBWF&nbsp;&nbsp; TMR_TEMP,W,A ; CARRY&nbsp; БУДЕТ ОЧИЩЕН ЕСЛИ ЗНАЧЕНИЕ ТАЙМЕРА &lt; 8C</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
BTFSS&nbsp;&nbsp; STATUS,C,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; ПРОПУСТИТЬ ЕСЛИ &gt;= 8C Т.Е. БОЛЬШЕ 2Т</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
GOTO&nbsp;&nbsp;&nbsp; TIMER_IS_2T</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MOVLW&nbsp;&nbsp;
 
2C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ; ВРЕМЕННОЙ ИНТЕРВАЛ РАВЕН 3Т&nbsp; ===&gt; 29</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
SUBWF&nbsp;&nbsp; TMR_TEMP,A,W ; CARRY&nbsp; БУДЕТ ОЧИЩЕН ЕСЛИ ЗНАЧЕНИЕ ТАЙМЕРА &lt; CF</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
BTFSS&nbsp;&nbsp;
 STATUS,C,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; 
ПРОПУСТИТЬ ЕСЛИ &gt;= CF Т.Е. ВРЕМЕННОЙ ИНТЕРВАЛ
РАВЕН 4Т</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US">GOTO&nbsp;&nbsp;&nbsp;
TIMER_IS_3T</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">;****************************************</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">TIMER_IS_4T</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;">BTFSS&nbsp;&nbsp; RC5_RX,0,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; ПРЕДЫДУЩИЙ БИТ БЫЛ "1" ?</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
GOTO&nbsp;&nbsp;&nbsp; RC5_RX_ERROR ; ЕСЛИ, БЫЛ "0", ТОГДА ОШИБКА!</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
GOTO&nbsp;&nbsp;&nbsp; RC5_ADD_01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; ПОСЛЕДНИЙ БИТ = "1", ТОГДА ДОБАВИМ
"01"</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">;****************************************</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">TIMER_IS_2T</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BTFSS&nbsp;&nbsp; RC5_RX,0,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ПРЕДЫДУЩИЙ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;"> </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">БИТ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;"> </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">БЫЛ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> "1" ?</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></b><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;">GOTO&nbsp;&nbsp;&nbsp; RC5_ADD_0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; ЕСЛИ, БЫЛ "0", ДОБАВИМ
"0"</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
GOTO&nbsp;&nbsp;&nbsp; RC5_ADD_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; НЕТ, БЫЛ "1", ДОБАВИМ "1"</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">;****************************************</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">TIMER_IS_3T</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BTFSS&nbsp;&nbsp; RC5_RX,0,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ПРЕДЫДУЩИЙ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;"> </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">БИТ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;"> </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">БЫЛ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> "1" ?</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;">GOTO&nbsp;&nbsp;&nbsp; RC5_ADD_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; ЕСЛИ, БЫЛ "0", ДОБАВИМ
"1"</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
GOTO&nbsp;&nbsp;&nbsp; RC5_ADD_00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; ПОСЛЕДНИЙ БИТ = "1", ТОГДА ДОБАВИМ
"00"</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;****************************************</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">RC5_ADD_0</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RLCF&nbsp;&nbsp; RC5_RX,F,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
СДВИГАЕМ ПРИНЯТУЮ ПОСЛЕДОВАТЕЛЬНОСТЬ ЧЕРЕЗ БИТ ПЕРЕНОСА</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US">RLCF&nbsp;&nbsp; RC5_RX1,F,A</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 BCF&nbsp;&nbsp;&nbsp; 
RC5_RX,0,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
 </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">И</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;"> </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ДОБАВЛЯЕМ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> 0</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;">INCF&nbsp;&nbsp;&nbsp; RC5_BIT_COUNT,F,A&nbsp;&nbsp; ; УВЕЛИЧИТЬ СЧЕТЧИК ПРИНЯТЫХ БИТ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">RC5_ADD_1</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RLCF&nbsp;&nbsp; RC5_RX,F,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
СДВИГАЕМ ПРИНЯТУЮ ПОСЛЕДОВАТЕЛЬНОСТЬ ЧЕРЕЗ БИТ ПЕРЕНОСА</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US">RLCF&nbsp;&nbsp; RC5_RX1,F,A</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 BSF&nbsp;&nbsp;&nbsp; 
RC5_RX,0,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
 </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">И</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;"> </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ДОБАВЛЯЕМ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> 1</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;">INCF&nbsp;&nbsp;&nbsp; RC5_BIT_COUNT,F,A&nbsp;&nbsp; ; УВЕЛИЧИТЬ СЧЕТЧИК ПРИНЯТЫХ БИТ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US">RETURN</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">RC5_ADD_00</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 CALL&nbsp;&nbsp; 
RC5_ADD_0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ДОБАВЛЯЕМ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> 0 </span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 GOTO&nbsp;&nbsp; 
RC5_ADD_0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ДОБАВЛЯЕМ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> 0</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">RC5_ADD_01</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 CALL&nbsp;&nbsp; 
RC5_ADD_0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ДОБАВЛЯЕМ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> 0 </span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 GOTO&nbsp;&nbsp; 
RC5_ADD_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ДОБАВЛЯЕМ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> 1</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;****************************************</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">RC5_RX_ERROR</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">INIT_RC5</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 CLRF&nbsp;&nbsp; 
RC5_RX,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ;
НАЧАЛЬНАЯ УСТАНОВКА ПЕРЕМЕННЫХ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 CLRF&nbsp;&nbsp; 
RC5_RX1,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ;
ОБНУЛЕНИЕ РЕГИСТРОВ РЕЗУЛЬТАТА</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CLRF&nbsp;&nbsp; RC5_BIT_COUNT,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
ОБНУЛЯЕМ СЧЕТЧИК ПРИНЯТЫХ ДАННЫХ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">INT_RB0_INIT</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 BSF&nbsp;&nbsp;&nbsp; 
TRISB,0,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ;
ВЫВОД ПОРТА RB0 НАСТРОИТЬ ДЛЯ ПРИЕМА ДАННЫХ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BCF&nbsp;&nbsp;&nbsp; INTCON,INT0IF,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
СБРОСИТЬ ФЛАГ ПРЕРЫВАНИЯ ОТ СИГНАЛА INT</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BCF&nbsp;&nbsp;&nbsp; INTCON2,INTEDG0,A&nbsp;&nbsp;&nbsp; ;
ПРЕРЫВАНИЕ ПО СПАДУ СИГНАЛА INT</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BSF&nbsp;&nbsp;&nbsp; INTCON,INT0IE,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
РАЗРЕШИТЬ ПРЕРЫВАНИЯ ОТ СИГНАЛА INT</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">INT_TMR0_INIT</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVLW&nbsp; B'11000111'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
КОЭФ ДЕЛЕНИЯ 16 ЧАСТОТА ПРЕРЫВАНИЙ ПРИ 16 МГц 1000 Гц</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ХХХ&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;ВЫБОР КОЭФФИЦИЕНТА ДЕЛЕНИЯ 2,4,8,16,32,64,128,256</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;
0,1,2,3 ,4 ,5 ,6&nbsp; ,7</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CLRF&nbsp;&nbsp; TMR0L,A</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BSF&nbsp;&nbsp;&nbsp; INTCON,TMR0IE,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
РАЗРЕШЕНО ПРЕРЫВАНИЕ ОТ ТАЙМЕРА</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;****************************************</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
СЮДА ПОПАДАЕМ ЕСЛИ ВРЕМЯ ОЖИДАНИЯ СИГНАЛА НА ВХОДЕ RB0 ПРЕВЫСИЛО ДОПУСТИМОЕ </span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">RC5_TMR0_PROC</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BCF&nbsp;&nbsp;&nbsp; INTCON,INT0IE,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
ЗАПРЕТИТЬ ПРЕРЫВАНИЕ ОТ СИГНАЛА INT</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BCF&nbsp;&nbsp;&nbsp; INTCON,INT0IF,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
СБРОСИТЬ ФЛАГ ПРЕРЫВАНИЯ ОТ ВХОДА INT</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 BCF&nbsp;&nbsp;&nbsp; 
RC5_START&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ;
ВРЕМЯ ОЖИДАНИЯ ИМПУЛЬСОВ RC5 ИСТЕКЛО</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 BSF&nbsp;&nbsp;&nbsp; 
RC5_ANALIZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
УСТАНОВИТЬ ФЛАГ НЕОБХОДИМОСТИ АНАЛИЗА ПРИНЯТЫХ ДАННЫХ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;****************************************</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
СТАРТ АНАЛИЗА ПРИНЯТОЙ ИК ПОСЛЕДОВАТЕЛЬНОСТИ </span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
ПРОГРАММА АНАЛИЗА ПРИНЯТОГО КОДА ВЫЗЫВАЕТСЯ В СЛУЧАЕЕ ЕСЛИ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
БЫЛ УСТАНОВЛЕН ФЛАГ ПРИЕМА КОДА RC5 КОТОРЫЙ УСТАНАВЛИВАЕТСЯ ПРОГРАММОЙ ПРИЕМА</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
ОПРОС СОСТОЯНИЯ ФЛАГА ПРОИСХОДИТ В ОСНОВНОМ ТЕЛЕ ЦИКЛА ОЖИДАНИЯ СОБЫТИЙ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ANALIZATOR_RC5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
ПРОГРАММА АНАЛИЗА ПРИНЯТОГО&nbsp; КОДА  </span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MOVLW&nbsp;&nbsp;
 
.14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ; СЧЁТЧИК БИТОВ RC-5 ДОЛЖЕН БЫТЬ РАВЕН 14</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US">SUBWF&nbsp;&nbsp;
RC5_BIT_COUNT,W,A&nbsp;&nbsp; ; </span></b><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;">ПРОВЕРЯЕМ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;">BTFSC&nbsp;&nbsp; STATUS,Z,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; ПРОПУСТИТЬ ЕСЛИ HE РАВЕН 14</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
GOTO&nbsp;&nbsp;&nbsp; RC5_RESIVED&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; ПРИНЯТЫЕ ДАННЫЕ ПО RC5 ВЕРНЫ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
ЕСЛИ В ПОСЛЕДОВАТЕЛЬНОСТИ RC-5 ПОСЛЕДНИЙ БИТ РАВЕН 0 ТО МЫ ПРИМЕМ ТОЛЬКО 13 БИТ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
В ТАКОМ СЛУЧАЕ НУЖНО ДОБАВИТЬ 0 И БУДЕТ ВСЕ ОК ИНАЧЕ ЭТО ОШИБКА ПРИЕМА</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
MOVLW&nbsp;&nbsp;
 
.13&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ; СЧЁТЧИК БИТОВ RC-5 ДОЛЖЕН БЫТЬ РАВЕН 13</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US">SUBWF&nbsp;&nbsp;
RC5_BIT_COUNT,W,A&nbsp;&nbsp; ; </span></b><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;">ПРОВЕРЯЕМ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BTFSS&nbsp;&nbsp; STATUS,Z,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ПРОПУСТИТЬ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;"> </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ЕСЛИ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> = 13, НУЖНО ДОБАВИТЬ 0</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; GOTO&nbsp;&nbsp; RC5_RX_ERROR</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 CALL&nbsp;&nbsp; 
RC5_ADD_0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">ДОБАВЛЯЕМ</span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US"> 0</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;****************************************</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
НА ЭТОМ СОБСТВЕННО И ВСЕ. ДАННЫЕ ПРИНЯТЫ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
А ТЕПЕРЬ БУДЕМ ДУМАТЬ&nbsp; ЧТО С НИМИ ДЕЛАТЬ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">RC5_RESIVED</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVF&nbsp;&nbsp; RC5_RX,W,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
ДАННЫЕ ПОМЕЩАЕМ В ДРУГИЕ РЕГИСТРЫ ДЛЯ ДАЛЬНЕЙШЕЙ ОБРАБОТКИ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 MOVWF&nbsp; 
RC5_REG,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 ;&nbsp;
И ИНДИКАЦИИ </span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></b><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;" lang="EN-US">MOVF&nbsp;&nbsp; RC5_RX1,W,A</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVWF&nbsp; RC5_REG1,A</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:
&quot;Courier New&quot;" lang="EN-US">&nbsp;</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;
ОБРАБОТКА ПОЛУЧЕННОЙ КОМАНДЫ RC5</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MOVLW&nbsp; 1F</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ANDWF&nbsp; RC5_REG1,F,A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;
УБРАЛИ СТАРТОВЫЙ БИТ</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">&nbsp;</span></b></p>

<p class="MsoNormal"><b><span style="font-size:10.0pt;font-family:&quot;Courier New&quot;">;==========================================================</span></b></p>

</div>



<p><b>Принципиальная схема ИК устройства управления отображением информации </b>
</p><p>
В заключении приведу схему устройства. 
 <br> <a href="http://www.yakorev.com.ru/map/irmap1.sch">irmap1.sch Схема в формате PCAD2002 </a>
 <br> <a href="http://www.yakorev.com.ru/map/shirmap.jpg">shirmap.jpg Схема в формате JPEG </a>
 <br> Основу всей схемы составляет микроконтроллера PIC18F252.
Схема состоит из следующих основных узлов: стабилизатор напряжения, согласование уровней RS232, 
сброса и индикации, приема передачи ИК команд, сдвиговые регистры и ключи. 
<br> Блок питания выполнен на основе импульсного стабилизатора. 
Это сделано для того что иметь широкий диапазон питающих напряжений от 8В до 40В, 
совместимый с питанием для устройств промышленной автоматики. 
<br> Согласование уровней выполнено на микросхеме МАХ232 по типовой схеме включения.
<br> Особенностью данного устройства является применение узла индикации и сброса установок по умолчанию.
Схемотехника этого узла оригинальна, я не встречал подобного в сети. 
При помощи всего одного вывода микроконтроллера PIC18F252 осушествляем индикацию работы, 
и этот же вывод микроконтроллера PIC18F252 служит входом для программного сброса установок в EEPROM памяти.
Переключение между индикацией и опросом состояния входа происходит с интервалом примерно 0,5С. 
Для наблюдателя светодиод просто мигает с частотой 1-2Гц, 
но стоит замкнуть джампер как произойдет программный сброс установок по умолчанию.
<br> Печатная плата для этого устройства специально не разрабатывалась, 
так как использовалась печатная плата для аналогичного устройства. 
На плате не были впаяны некоторые элементы, которые просто не нужны в данной разработке.
Внешний вид платы без сдвиговых регистров и ключей показан на фото ниже.
</p><p><img src="rc5_files/map17.jpg" nosave="" width="100%"> 
</p><p><b>Плата приема команд ИК управления формата RC5 </b>
</p><p>
</p><p>
 <br><b></b></p><center><b> Исходные файлы проекта:</b></center>
 <br> <a href="http://www.yakorev.com.ru/map/irmap1.sch">irmap1.sch Схема в формате PCAD2002 </a>
  <br> <a href="http://www.yakorev.com.ru/map/shirmap.jpg">shirmap.jpg Схема в формате JPEG </a>
 <br> <a href="http://www.yakorev.com.ru/map/map.asm">map.asm 1.Основной ASM файл  </a>  
 <br> <a href="http://www.yakorev.com.ru/map/map_eq.txt">map_eq.inc 2.Файл определений переменных, констант , регистров</a>  
 <br> <a href="http://www.yakorev.com.ru/map/prmprd.txt">prmprd.inc 3.Файл подпрограмм ввода вывода </a>  
 <br> <a href="http://www.yakorev.com.ru/map/inicial.txt">inicial.inc 4.Файл подпрограмм инициализации узлов микроконтроллера</a>  
 <br> <a href="http://www.yakorev.com.ru/map/map.txt">map.inc 5.Файл обслуживания узла сброса и индикации</a>  
 <br> <a href="http://www.yakorev.com.ru/map/ir_map.txt">ir_map.inc 6.Файл приема команд управления по ИК </a>  
 <br> <a href="http://www.yakorev.com.ru/map/prog.txt">prog.inc 7.Файл приема команд управления по RS232</a>  
 <br> <a href="http://www.yakorev.com.ru/map/tablper.txt">program.inc Ф8.Файл вычисляемых таблиц переходов</a>  
<p>
В заключении хочется отметить , что устройство обладает целым рядом других 
дополнительных возможностей которые не описаны в данной статье. 
Пожалуйста обращайтесь к  
<b> <a href="http://www.yakorev.com.ru/www.yakorev.com.ru">разработчику</a></b> за дополнительной информацией.
<br>
<a href="http://www.yakorev.com.ru/" target="_blank"><img alt="" src="rc5_files/baner.gif" border="0" width="250"></a> 

</p></td></tr></tbody></table>


</body></html>